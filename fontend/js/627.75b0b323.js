"use strict";(self["webpackChunkyanchat"]=self["webpackChunkyanchat"]||[]).push([[627],{627:function(e,n,t){t.r(n),t.d(n,{default:function(){return me}});t(7658);var o=t(3396),s=t(7139),a=t(4870),l=t(9242),r=t(2483),i=t(7150),u=t(3744),c=t(5407),d=t(1015),p=t(5989),f=t(9619);const v='a[href],button:not([disabled]),button:not([hidden]),:not([tabindex="-1"]),input:not([disabled]),input:not([type="hidden"]),select:not([disabled]),textarea:not([disabled])',g=e=>{const n=getComputedStyle(e);return"fixed"!==n.position&&null!==e.offsetParent},m=e=>Array.from(e.querySelectorAll(v)).filter((e=>h(e)&&g(e))),h=e=>{if(e.tabIndex>0||0===e.tabIndex&&null!==e.getAttribute("tabIndex"))return!0;if(e.disabled)return!1;switch(e.nodeName){case"A":return!!e.href&&"ignore"!==e.rel;case"INPUT":return!("hidden"===e.type||"file"===e.type);case"BUTTON":case"SELECT":case"TEXTAREA":return!0;default:return!1}},y="_trap-focus-children",b=[],C=e=>{if(0===b.length)return;const n=b[b.length-1][y];if(n.length>0&&e.code===f.EVENT_CODE.tab){if(1===n.length)return e.preventDefault(),void(document.activeElement!==n[0]&&n[0].focus());const t=e.shiftKey,o=e.target===n[0],s=e.target===n[n.length-1];o&&t&&(e.preventDefault(),n[n.length-1].focus()),s&&!t&&(e.preventDefault(),n[0].focus())}},w={beforeMount(e){e[y]=m(e),b.push(e),b.length<=1&&document.addEventListener("keydown",C)},updated(e){(0,o.Y3)((()=>{e[y]=m(e)}))},unmounted(){b.shift(),0===b.length&&document.removeEventListener("keydown",C)}};var _=t(5554),k=t(2039),E=t(4961),x=t(3965),B=t(8925),I=t(4389),T=t(3319),M=t(3388);const S=(0,o.aZ)({name:"ElMessageBox",directives:{TrapFocus:w},components:{ElButton:i.mi,ElFocusTrap:_.Z,ElInput:u.EZ,ElOverlay:c.F6,ElIcon:d.gn,...k.TypeComponents},inheritAttrs:!1,props:{buttonSize:{type:String,validator:E.P},modal:{type:Boolean,default:!0},lockScroll:{type:Boolean,default:!0},showClose:{type:Boolean,default:!0},closeOnClickModal:{type:Boolean,default:!0},closeOnPressEscape:{type:Boolean,default:!0},closeOnHashChange:{type:Boolean,default:!0},center:Boolean,draggable:Boolean,roundButton:{default:!1,type:Boolean},container:{type:String,default:"body"},boxType:{type:String,default:""}},emits:["vanish","action"],setup(e,{emit:n}){const{locale:t,zIndex:s,ns:l,size:r}=(0,x.cU)("message-box",(0,o.Fl)((()=>e.buttonSize))),{t:i}=t,{nextZIndex:u}=s,c=(0,a.iH)(!1),d=(0,a.qj)({autofocus:!0,beforeClose:null,callback:null,cancelButtonText:"",cancelButtonClass:"",confirmButtonText:"",confirmButtonClass:"",customClass:"",customStyle:{},dangerouslyUseHTMLString:!1,distinguishCancelAndClose:!1,icon:"",inputPattern:null,inputPlaceholder:"",inputType:"text",inputValue:null,inputValidator:null,inputErrorMessage:"",message:null,modalFade:!0,modalClass:"",showCancelButton:!1,showConfirmButton:!0,type:"",title:void 0,showInput:!1,action:"",confirmButtonLoading:!1,cancelButtonLoading:!1,confirmButtonDisabled:!1,editorErrorMessage:"",validateError:!1,zIndex:u()}),p=(0,o.Fl)((()=>{const e=d.type;return{[l.bm("icon",e)]:e&&k.Rp[e]}})),f=(0,B.Me)(),v=(0,B.Me)(),g=(0,o.Fl)((()=>d.icon||k.Rp[d.type]||"")),m=(0,o.Fl)((()=>!!d.message)),h=(0,a.iH)(),y=(0,a.iH)(),b=(0,a.iH)(),C=(0,a.iH)(),w=(0,a.iH)(),_=(0,o.Fl)((()=>d.confirmButtonClass));(0,o.YP)((()=>d.inputValue),(async n=>{await(0,o.Y3)(),"prompt"===e.boxType&&null!==n&&H()}),{immediate:!0}),(0,o.YP)((()=>c.value),(n=>{var t,s;n&&("prompt"!==e.boxType&&(d.autofocus?b.value=null!=(s=null==(t=w.value)?void 0:t.$el)?s:h.value:b.value=h.value),d.zIndex=u()),"prompt"===e.boxType&&(n?(0,o.Y3)().then((()=>{var e;C.value&&C.value.$el&&(d.autofocus?b.value=null!=(e=P())?e:h.value:b.value=h.value)})):(d.editorErrorMessage="",d.validateError=!1))}));const E=(0,o.Fl)((()=>e.draggable));function S(){c.value&&(c.value=!1,(0,o.Y3)((()=>{d.action&&n("action",d.action)})))}(0,I.O)(h,y,E),(0,o.bv)((async()=>{await(0,o.Y3)(),e.closeOnHashChange&&window.addEventListener("hashchange",S)})),(0,o.Jd)((()=>{e.closeOnHashChange&&window.removeEventListener("hashchange",S)}));const L=()=>{e.closeOnClickModal&&R(d.distinguishCancelAndClose?"close":"cancel")},z=(0,T.S)(L),A=e=>{if("textarea"!==d.inputType)return e.preventDefault(),R("confirm")},R=n=>{var t;("prompt"!==e.boxType||"confirm"!==n||H())&&(d.action=n,d.beforeClose?null==(t=d.beforeClose)||t.call(d,n,d,S):S())},H=()=>{if("prompt"===e.boxType){const e=d.inputPattern;if(e&&!e.test(d.inputValue||""))return d.editorErrorMessage=d.inputErrorMessage||i("el.messagebox.error"),d.validateError=!0,!1;const n=d.inputValidator;if("function"===typeof n){const e=n(d.inputValue);if(!1===e)return d.editorErrorMessage=d.inputErrorMessage||i("el.messagebox.error"),d.validateError=!0,!1;if("string"===typeof e)return d.editorErrorMessage=e,d.validateError=!0,!1}}return d.editorErrorMessage="",d.validateError=!1,!0},P=()=>{const e=C.value.$refs;return e.input||e.textarea},D=()=>{R("close")},O=()=>{e.closeOnPressEscape&&D()};return e.lockScroll&&(0,M.W)(c),{...(0,a.BK)(d),ns:l,overlayEvent:z,visible:c,hasMessage:m,typeClass:p,contentId:f,inputId:v,btnSize:r,iconComponent:g,confirmButtonClasses:_,rootRef:h,focusStartRef:b,headerRef:y,inputRef:C,confirmRef:w,doClose:S,handleClose:D,onCloseRequested:O,handleWrapperClick:L,handleInputEnter:A,handleAction:R,t:i}}}),L=["aria-label","aria-describedby"],z=["aria-label"],A=["id"];function R(e,n,t,a,r,i){const u=(0,o.up)("el-icon"),c=(0,o.up)("close"),d=(0,o.up)("el-input"),p=(0,o.up)("el-button"),f=(0,o.up)("el-focus-trap"),v=(0,o.up)("el-overlay");return(0,o.wg)(),(0,o.j4)(l.uT,{name:"fade-in-linear",onAfterLeave:n[11]||(n[11]=n=>e.$emit("vanish")),persisted:""},{default:(0,o.w5)((()=>[(0,o.wy)((0,o.Wm)(v,{"z-index":e.zIndex,"overlay-class":[e.ns.is("message-box"),e.modalClass],mask:e.modal},{default:(0,o.w5)((()=>[(0,o._)("div",{role:"dialog","aria-label":e.title,"aria-modal":"true","aria-describedby":e.showInput?void 0:e.contentId,class:(0,s.C_)(`${e.ns.namespace.value}-overlay-message-box`),onClick:n[8]||(n[8]=(...n)=>e.overlayEvent.onClick&&e.overlayEvent.onClick(...n)),onMousedown:n[9]||(n[9]=(...n)=>e.overlayEvent.onMousedown&&e.overlayEvent.onMousedown(...n)),onMouseup:n[10]||(n[10]=(...n)=>e.overlayEvent.onMouseup&&e.overlayEvent.onMouseup(...n))},[(0,o.Wm)(f,{loop:"",trapped:e.visible,"focus-trap-el":e.rootRef,"focus-start-el":e.focusStartRef,onReleaseRequested:e.onCloseRequested},{default:(0,o.w5)((()=>[(0,o._)("div",{ref:"rootRef",class:(0,s.C_)([e.ns.b(),e.customClass,e.ns.is("draggable",e.draggable),{[e.ns.m("center")]:e.center}]),style:(0,s.j5)(e.customStyle),tabindex:"-1",onClick:n[7]||(n[7]=(0,l.iM)((()=>{}),["stop"]))},[null!==e.title&&void 0!==e.title?((0,o.wg)(),(0,o.iD)("div",{key:0,ref:"headerRef",class:(0,s.C_)(e.ns.e("header"))},[(0,o._)("div",{class:(0,s.C_)(e.ns.e("title"))},[e.iconComponent&&e.center?((0,o.wg)(),(0,o.j4)(u,{key:0,class:(0,s.C_)([e.ns.e("status"),e.typeClass])},{default:(0,o.w5)((()=>[((0,o.wg)(),(0,o.j4)((0,o.LL)(e.iconComponent)))])),_:1},8,["class"])):(0,o.kq)("v-if",!0),(0,o._)("span",null,(0,s.zw)(e.title),1)],2),e.showClose?((0,o.wg)(),(0,o.iD)("button",{key:0,type:"button",class:(0,s.C_)(e.ns.e("headerbtn")),"aria-label":e.t("el.messagebox.close"),onClick:n[0]||(n[0]=n=>e.handleAction(e.distinguishCancelAndClose?"close":"cancel")),onKeydown:n[1]||(n[1]=(0,l.D2)((0,l.iM)((n=>e.handleAction(e.distinguishCancelAndClose?"close":"cancel")),["prevent"]),["enter"]))},[(0,o.Wm)(u,{class:(0,s.C_)(e.ns.e("close"))},{default:(0,o.w5)((()=>[(0,o.Wm)(c)])),_:1},8,["class"])],42,z)):(0,o.kq)("v-if",!0)],2)):(0,o.kq)("v-if",!0),(0,o._)("div",{id:e.contentId,class:(0,s.C_)(e.ns.e("content"))},[(0,o._)("div",{class:(0,s.C_)(e.ns.e("container"))},[e.iconComponent&&!e.center&&e.hasMessage?((0,o.wg)(),(0,o.j4)(u,{key:0,class:(0,s.C_)([e.ns.e("status"),e.typeClass])},{default:(0,o.w5)((()=>[((0,o.wg)(),(0,o.j4)((0,o.LL)(e.iconComponent)))])),_:1},8,["class"])):(0,o.kq)("v-if",!0),e.hasMessage?((0,o.wg)(),(0,o.iD)("div",{key:1,class:(0,s.C_)(e.ns.e("message"))},[(0,o.WI)(e.$slots,"default",{},(()=>[e.dangerouslyUseHTMLString?((0,o.wg)(),(0,o.j4)((0,o.LL)(e.showInput?"label":"p"),{key:1,for:e.showInput?e.inputId:void 0,innerHTML:e.message},null,8,["for","innerHTML"])):((0,o.wg)(),(0,o.j4)((0,o.LL)(e.showInput?"label":"p"),{key:0,for:e.showInput?e.inputId:void 0},{default:(0,o.w5)((()=>[(0,o.Uk)((0,s.zw)(e.dangerouslyUseHTMLString?"":e.message),1)])),_:1},8,["for"]))]))],2)):(0,o.kq)("v-if",!0)],2),(0,o.wy)((0,o._)("div",{class:(0,s.C_)(e.ns.e("input"))},[(0,o.Wm)(d,{id:e.inputId,ref:"inputRef",modelValue:e.inputValue,"onUpdate:modelValue":n[2]||(n[2]=n=>e.inputValue=n),type:e.inputType,placeholder:e.inputPlaceholder,"aria-invalid":e.validateError,class:(0,s.C_)({invalid:e.validateError}),onKeydown:(0,l.D2)(e.handleInputEnter,["enter"])},null,8,["id","modelValue","type","placeholder","aria-invalid","class","onKeydown"]),(0,o._)("div",{class:(0,s.C_)(e.ns.e("errormsg")),style:(0,s.j5)({visibility:e.editorErrorMessage?"visible":"hidden"})},(0,s.zw)(e.editorErrorMessage),7)],2),[[l.F8,e.showInput]])],10,A),(0,o._)("div",{class:(0,s.C_)(e.ns.e("btns"))},[e.showCancelButton?((0,o.wg)(),(0,o.j4)(p,{key:0,loading:e.cancelButtonLoading,class:(0,s.C_)([e.cancelButtonClass]),round:e.roundButton,size:e.btnSize,onClick:n[3]||(n[3]=n=>e.handleAction("cancel")),onKeydown:n[4]||(n[4]=(0,l.D2)((0,l.iM)((n=>e.handleAction("cancel")),["prevent"]),["enter"]))},{default:(0,o.w5)((()=>[(0,o.Uk)((0,s.zw)(e.cancelButtonText||e.t("el.messagebox.cancel")),1)])),_:1},8,["loading","class","round","size"])):(0,o.kq)("v-if",!0),(0,o.wy)((0,o.Wm)(p,{ref:"confirmRef",type:"primary",loading:e.confirmButtonLoading,class:(0,s.C_)([e.confirmButtonClasses]),round:e.roundButton,disabled:e.confirmButtonDisabled,size:e.btnSize,onClick:n[5]||(n[5]=n=>e.handleAction("confirm")),onKeydown:n[6]||(n[6]=(0,l.D2)((0,l.iM)((n=>e.handleAction("confirm")),["prevent"]),["enter"]))},{default:(0,o.w5)((()=>[(0,o.Uk)((0,s.zw)(e.confirmButtonText||e.t("el.messagebox.confirm")),1)])),_:1},8,["loading","class","round","disabled","size"]),[[l.F8,e.showConfirmButton]])],2)],6)])),_:3},8,["trapped","focus-trap-el","focus-start-el","onReleaseRequested"])],42,L)])),_:3},8,["z-index","overlay-class","mask"]),[[l.F8,e.visible]])])),_:3})}var H=(0,p.Z)(S,[["render",R],["__file","/home/runner/work/element-plus/element-plus/packages/components/message-box/src/index.vue"]]),P=t(7354),D=t(4620),O=t(2019);const q=new Map,U=e=>{let n=document.body;return e.appendTo&&((0,s.HD)(e.appendTo)&&(n=document.querySelector(e.appendTo)),(0,P.kK)(e.appendTo)&&(n=e.appendTo),(0,P.kK)(n)||((0,D.N)("ElMessageBox","the appendTo option is not an HTMLElement. Falling back to document.body."),n=document.body)),n},$=(e,n,t=null)=>{const a=(0,o.Wm)(H,e,(0,s.mf)(e.message)||(0,o.lA)(e.message)?{default:(0,s.mf)(e.message)?e.message:()=>e.message}:null);return a.appContext=t,(0,l.sY)(a,n),U(e).appendChild(n.firstElementChild),a.component},j=()=>document.createElement("div"),V=(e,n)=>{const t=j();e.onVanish=()=>{(0,l.sY)(null,t),q.delete(a)},e.onAction=n=>{const t=q.get(a);let s;s=e.showInput?{value:a.inputValue,action:n}:n,e.callback?e.callback(s,o.proxy):"cancel"===n||"close"===n?e.distinguishCancelAndClose&&"cancel"!==n?t.reject("close"):t.reject("cancel"):t.resolve(s)};const o=$(e,t,n),a=o.proxy;for(const l in e)(0,s.RI)(e,l)&&!(0,s.RI)(a.$props,l)&&(a[l]=e[l]);return a.visible=!0,a};function F(e,n=null){if(!O.C5)return Promise.reject();let t;return(0,s.HD)(e)||(0,o.lA)(e)?e={message:e}:t=e.callback,new Promise(((o,s)=>{const a=V(e,null!=n?n:F._context);q.set(a,{options:e,callback:t,resolve:o,reject:s})}))}const W=["alert","confirm","prompt"],Z={alert:{closeOnPressEscape:!1,closeOnClickModal:!1},confirm:{showCancelButton:!0},prompt:{showCancelButton:!0,showInput:!0}};function K(e){return(n,t,o,a)=>{let l="";return(0,s.Kn)(t)?(o=t,l=""):l=(0,P.o8)(t)?"":t,F(Object.assign({title:l,message:n,type:"",...Z[e]},o,{boxType:e}),a)}}W.forEach((e=>{F[e]=K(e)})),F.close=()=>{q.forEach(((e,n)=>{n.doClose()})),q.clear()},F._context=null;const Y=F;Y.install=e=>{Y._context=e._context,e.config.globalProperties.$msgbox=Y,e.config.globalProperties.$messageBox=Y,e.config.globalProperties.$alert=Y.alert,e.config.globalProperties.$confirm=Y.confirm,e.config.globalProperties.$prompt=Y.prompt};const N=Y;var J=t(4578),X=t(2218),G=t(3625),Q=t(7823);const ee=e=>(0,Q.W)({url:"/login",method:"post",data:e}),ne=e=>(0,Q.W)({url:"/register",method:"post",data:e});var te=t(5187);const oe=e=>((0,o.dD)("data-v-761e43b5"),e=e(),(0,o.Cn)(),e),se=oe((()=>(0,o._)("div",{class:"welcome"}," 欢迎登录 ",-1))),ae={class:"login"},le={class:"login-text"},re=oe((()=>(0,o._)("span",{class:"login-id"},"手机号:",-1))),ie={class:"login-text"},ue=oe((()=>(0,o._)("span",{class:"login-id"},"密码:",-1))),ce={key:0,class:"pw-err"},de={key:1,class:"pw-err"},pe=oe((()=>(0,o._)("section",{class:"forget-pw"},null,-1)));var fe=(0,o.aZ)({__name:"loginIndex",setup(e){let n=(0,a.iH)(),t=(0,a.iH)(""),i=(0,a.iH)(""),u=(0,a.iH)(!1),c=(0,a.iH)(!1);const d=(0,a.iH)("PC");(0,o.bv)((()=>{n.value=(0,r.tv)(),window.outerWidth<600&&(d.value="MOBILE"),/Mobi|Android|iPhone/i.test(navigator.userAgent)?(d.value="MOBILE",console.log("mobile")):(d.value="PC",console.log("pc"))}));const p=(0,X.Z)((()=>{u.value=!0}),300),f=(0,X.Z)((()=>{c.value=!0}),300);async function v(){if(t.value&&i.value){const[o,s]=await(0,G.Z)(ee({phone_number:t.value,password:i.value}));if(o)return void console.log("登录错误：",o);const{status:a,data:l}=s;if(200!==a)return;const{user_data:r,auth:d}=l;if(sessionStorage.setItem("Token",d?.token??""),sessionStorage.setItem("RefreshToken",d?.refreshToken??""),"repeat"===r)return c.value=!1,void f();if("pw_err"===r)return u.value=!1,void p();if(u.value=!1,"err"!==r)return console.log("user_info",r),(0,te.ps)(r),console.log("setUserInfo",r),sessionStorage.setItem("user_id",r.user_id),n.value.replace({name:"Chat"}),void console.log("登录成功");N.confirm("当前用户尚未注册，是否自动注册并登录？","Warning",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning",center:!0}).then((()=>{e()})).catch((e=>{console.log(e)}))}async function e(){if(!/^1[345678]\d{9}$/.test(t.value))return void(0,J.z8)({message:`${t.value}: 电话号格式有误`,type:"error"});const[e,o]=await(0,G.Z)(ne({phone_number:t.value,password:i.value}));if(e)return void console.log("注册错误：",e);const{status:s,data:a}=o,{user_data:l,auth:r}=a;if(200===s){if("exist"===l)return void(0,J.z8)({message:`${t.value} 已经注册过了！`,type:"error"});if("err"===l)return void(0,J.z8)({message:`${t.value} 注册失败！`,type:"error"});sessionStorage.setItem("Token",r?.token??""),sessionStorage.setItem("RefreshToken",r?.refreshToken??""),(0,te.ps)(l),sessionStorage.setItem("user_id",l.user_id),(0,J.z8)({message:`${t.value} 已经成功注册！`,type:"success"}),n.value.push({name:"Chat"})}}}return(e,n)=>((0,o.wg)(),(0,o.iD)("main",{class:(0,s.C_)({container:"PC"===d.value,"mobile-container":"MOBILE"===d.value})},[(0,o._)("section",{class:(0,s.C_)(["login-box",{"mobile-login-box":"MOBILE"===d.value}])},[se,(0,o._)("section",ae,[(0,o._)("div",le,[re,(0,o.wy)((0,o._)("input",{type:"text",placeholder:"请输入你的手机号","onUpdate:modelValue":n[0]||(n[0]=e=>(0,a.dq)(t)?t.value=e:t=e),class:"input"},null,512),[[l.nr,(0,a.SU)(t)]])]),(0,o._)("div",ie,[ue,(0,o.wy)((0,o._)("input",{type:"password",placeholder:"请输入密码","onUpdate:modelValue":n[1]||(n[1]=e=>(0,a.dq)(i)?i.value=e:i=e),class:"input"},null,512),[[l.nr,(0,a.SU)(i)]]),(0,a.SU)(u)?((0,o.wg)(),(0,o.iD)("div",ce,"密码错误！")):(0,o.kq)("",!0),(0,a.SU)(c)?((0,o.wg)(),(0,o.iD)("div",de,"重复登录！")):(0,o.kq)("",!0)])]),pe,(0,o._)("section",null,[(0,o._)("div",null,[(0,o._)("button",{class:"login-in",onClick:v},"登录/注册")])])],2)],2))}}),ve=t(89);const ge=(0,ve.Z)(fe,[["__scopeId","data-v-761e43b5"]]);var me=ge}}]);
//# sourceMappingURL=627.75b0b323.js.map